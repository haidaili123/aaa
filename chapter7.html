<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬ä¸ƒç« ï¼š3Då›¾è¡¨ä¸åŠ¨ç”» - è±†æ²™ç²‰ä¸»é¢˜æ•°æ®å¯è§†åŒ–</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-matrix"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #FFF5F5 0%, #FFE4E1 25%, #FFDAB9 50%, #FFDAB9 75%, #FFE4E1 100%);
            min-height: 100vh;
            color: #5D4037;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.85);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(255, 182, 193, 0.2);
        }

        h1 {
            color: #D81B60;
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(216, 27, 96, 0.1);
        }

        .subtitle {
            color: #8D6E63;
            font-size: 1.2em;
            font-weight: 300;
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .nav-tab {
            padding: 12px 25px;
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #F8BBD0;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: #AD1457;
        }

        .nav-tab:hover {
            background: #FCE4EC;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 182, 193, 0.3);
        }

        .nav-tab.active {
            background: #E91E63;
            color: white;
            border-color: #E91E63;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(255, 182, 193, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 182, 193, 0.2);
        }

        .card h3 {
            color: #C2185B;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 3px solid #F8BBD0;
            padding-bottom: 10px;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 25px;
            padding: 20px;
            background: #FFF8F8;
            border-radius: 15px;
            border: 1px solid #FFCDD2;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        label {
            font-weight: 600;
            color: #7B5E57;
            font-size: 0.9em;
        }

        select, input[type="range"], input[type="number"], button {
            padding: 10px;
            border: 2px solid #F8BBD0;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #E91E63;
            box-shadow: 0 0 0 3px rgba(233, 30, 99, 0.1);
        }

        button {
            background: linear-gradient(135deg, #F48FB1 0%, #EC407A 100%);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
            padding: 12px 20px;
            transition: all 0.3s ease;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(236, 64, 122, 0.3);
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(255, 182, 193, 0.1);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .stat-card {
            background: linear-gradient(135deg, #FCE4EC 0%, #F8BBD0 100%);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #C2185B;
        }

        .stat-label {
            color: #8D6E63;
            margin-top: 5px;
        }

        .code-snippet {
            background: #FFF5F5;
            border-left: 4px solid #E91E63;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: #5D4037;
        }

        .animation-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }

        .animation-btn {
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: 600;
        }

        .animation-btn.play {
            background: linear-gradient(135deg, #66BB6A 0%, #4CAF50 100%);
        }

        .animation-btn.pause {
            background: linear-gradient(135deg, #FFA726 0%, #FF9800 100%);
        }

        .animation-btn.reset {
            background: linear-gradient(135deg, #EF5350 0%, #F44336 100%);
        }

        .three-d-container {
            perspective: 1000px;
            height: 400px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .three-d-scatter {
            width: 300px;
            height: 300px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.5s ease;
        }

        .star-3d {
            position: absolute;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, #FFD700 0%, #FFA000 100%);
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
            animation: twinkle 2s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.3; transform: scale(0.8); }
        }

        .axis-line {
            position: absolute;
            background: #C2185B;
            transform-origin: 0 0;
        }

        .axis-x {
            width: 300px;
            height: 2px;
            top: 150px;
            left: 0;
        }

        .axis-y {
            width: 2px;
            height: 300px;
            top: 0;
            left: 150px;
        }

        .axis-z {
            width: 2px;
            height: 200px;
            top: 50px;
            left: 150px;
            transform: rotateX(90deg);
        }

        .map-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(255, 182, 193, 0.1);
            height: 400px;
            position: relative;
            overflow: hidden;
        }

        .map-point {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle, #E91E63 0%, #C2185B 100%);
            opacity: 0.8;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .grid-layout {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .feature-box {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            border-left: 4px solid #E91E63;
            box-shadow: 0 4px 15px rgba(255, 182, 193, 0.1);
            transition: all 0.3s ease;
        }

        .feature-box:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 182, 193, 0.2);
        }

        .feature-title {
            color: #C2185B;
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .feature-desc {
            color: #7B5E57;
            line-height: 1.5;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .nav-tabs {
                flex-direction: column;
                align-items: center;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ç¬¬ä¸ƒç« ï¼š3Då›¾è¡¨ä¸åŠ¨ç”»</h1>
            <p class="subtitle">è±†æ²™ç²‰ä¸»é¢˜ - 3Dæ•°æ®å¯è§†åŒ–ã€åŠ¨ç”»åˆ¶ä½œä¸ç»Ÿè®¡åœ°å›¾</p>
        </header>

        <nav class="nav-tabs">
            <div class="nav-tab active" onclick="showTab('mplot3d')">7.1 mplot3dç»˜åˆ¶3Då›¾è¡¨</div>
            <div class="nav-tab" onclick="showTab('animation')">7.2 animationåˆ¶ä½œåŠ¨å›¾</div>
            <div class="nav-tab" onclick="showTab('basemap')">7.3 basemapç»˜åˆ¶ç»Ÿè®¡åœ°å›¾</div>
        </nav>

        <!-- 7.1 mplot3dç»˜åˆ¶3Då›¾è¡¨ -->
        <div id="mplot3d" class="tab-content active">
            <div class="card">
                <h3>ğŸŒŸ 3Dæ•£ç‚¹å›¾ - ä¸‰ç»´ç©ºé—´çš„æ˜Ÿæ˜Ÿ</h3>
                <div class="controls">
                    <div class="control-group">
                        <label>æ˜Ÿç‚¹æ•°é‡</label>
                        <input type="range" id="starCount" min="10" max="50" value="30">
                        <span id="starCountValue">30</span>
                    </div>
                    <div class="control-group">
                        <label>æ—‹è½¬é€Ÿåº¦</label>
                        <input type="range" id="rotationSpeed" min="1" max="10" value="5">
                    </div>
                    <div class="control-group">
                        <label>é¢œè‰²æ–¹æ¡ˆ</label>
                        <select id="colorScheme">
                            <option value="gradient">æ¸å˜è‰²</option>
                            <option value="height">æŒ‰é«˜åº¦ç€è‰²</option>
                            <option value="gold">é‡‘è‰²</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <button onclick="regenerateStars()">é‡æ–°ç”Ÿæˆ</button>
                    </div>
                </div>
                
                <div class="three-d-container">
                    <div class="three-d-scatter" id="threeDScatter">
                        <div class="axis-line axis-x"></div>
                        <div class="axis-line axis-y"></div>
                        <div class="axis-line axis-z"></div>
                    </div>
                </div>

                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-value" id="totalStars">30</div>
                        <div class="stat-label">æ˜Ÿç‚¹æ€»æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avgHeight">20</div>
                        <div class="stat-label">å¹³å‡é«˜åº¦</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="rotationAngle">0Â°</div>
                        <div class="stat-label">æ—‹è½¬è§’åº¦</div>
                    </div>
                </div>

                <div class="code-snippet">
                    # Python matplotlib 3Dæ•£ç‚¹å›¾ä»£ç ç¤ºä¾‹<br>
                    from mpl_toolkits.mplot3d import Axes3D<br>
                    ax.scatter(xx, yy, zz, c=color, marker='*', s=160, linewidth=1, edgecolor='black')
                </div>
            </div>

            <div class="card">
                <h3>ğŸ“Š 3Dæ›²é¢å›¾ - å‡½æ•°å¯è§†åŒ–</h3>
                <div class="controls">
                    <div class="control-group">
                        <label>å‡½æ•°ç±»å‹</label>
                        <select id="functionType" onchange="updateSurface()">
                            <option value="sinc">Sincå‡½æ•°</option>
                            <option value="gaussian">é«˜æ–¯å‡½æ•°</option>
                            <option value="ripple">æ¶Ÿæ¼ªå‡½æ•°</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>åˆ†è¾¨ç‡</label>
                        <select id="resolution" onchange="updateSurface()">
                            <option value="20">ä½</option>
                            <option value="40">ä¸­</option>
                            <option value="60">é«˜</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>é…è‰²æ–¹æ¡ˆ</label>
                        <select id="surfaceColors" onchange="updateSurface()">
                            <option value="coolwarm">å†·æš–è‰²</option>
                            <option value="viridis">ç¿ ç»¿è‰²</option>
                            <option value="plasma">ç­‰ç¦»å­è‰²</option>
                        </select>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="surfaceChart"></canvas>
                </div>
            </div>
        </div>

        <!-- 7.2 animationåˆ¶ä½œåŠ¨å›¾ -->
        <div id="animation" class="tab-content">
            <div class="card">
                <h3>âœ¨ é—ªçƒçš„æ˜Ÿæ˜ŸåŠ¨ç”»</h3>
                <div class="animation-controls">
                    <button class="animation-btn play" onclick="startAnimation()">â–¶ æ’­æ”¾</button>
                    <button class="animation-btn pause" onclick="pauseAnimation()">â¸ æš‚åœ</button>
                    <button class="animation-btn reset" onclick="resetAnimation()">âŸ² é‡ç½®</button>
                </div>
                
                <div class="controls">
                    <div class="control-group">
                        <label>é—ªçƒé€Ÿåº¦</label>
                        <input type="range" id="twinkleSpeed" min="100" max="2000" value="1000">
                        <span id="twinkleSpeedValue">1000ms</span>
                    </div>
                    <div class="control-group">
                        <label>æ˜Ÿæ˜Ÿæ•°é‡</label>
                        <input type="range" id="animStarCount" min="5" max="15" value="10">
                        <span id="animStarCountValue">10</span>
                    </div>
                    <div class="control-group">
                        <label>åŠ¨ç”»æ¨¡å¼</label>
                        <select id="animationMode">
                            <option value="twinkle">é—ªçƒ</option>
                            <option value="rotate">æ—‹è½¬</option>
                            <option value="pulse">è„‰å†²</option>
                        </select>
                    </div>
                </div>

                <div class="chart-container">
                    <canvas id="animationChart"></canvas>
                </div>

                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-value" id="frameCount">0</div>
                        <div class="stat-label">å½“å‰å¸§æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="animStatus">å°±ç»ª</div>
                        <div class="stat-label">åŠ¨ç”»çŠ¶æ€</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="animDuration">0s</div>
                        <div class="stat-label">è¿è¡Œæ—¶é•¿</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>ğŸ“ˆ æ­£å¼¦æ³¢åŠ¨ç”»</h3>
                <div class="controls">
                    <div class="control-group">
                        <label>æ³¢å½¢æ•°é‡</label>
                        <input type="range" id="waveCount" min="1" max="5" value="2">
                        <span id="waveCountValue">2</span>
                    </div>
                    <div class="control-group">
                        <label>åŠ¨ç”»é€Ÿåº¦</label>
                        <input type="range" id="waveSpeed" min="1" max="20" value="10">
                        <span id="waveSpeedValue">10</span>
                    </div>
                    <div class="control-group">
                        <label>ç›¸ä½å·®</label>
                        <input type="range" id="phaseShift" min="0" max="180" value="90">
                        <span id="phaseShiftValue">90Â°</span>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="waveChart"></canvas>
                </div>
            </div>
        </div>

        <!-- 7.3 basemapç»˜åˆ¶ç»Ÿè®¡åœ°å›¾ -->
        <div id="basemap" class="tab-content">
            <div class="card">
                <h3>ğŸ—ºï¸ äººå£åˆ†å¸ƒç»Ÿè®¡åœ°å›¾</h3>
                <div class="controls">
                    <div class="control-group">
                        <label>æ•°æ®é›†å¤§å°</label>
                        <select id="dataSize" onchange="updateMap()">
                            <option value="100">100ä¸ªåŸå¸‚</option>
                            <option value="300">300ä¸ªåŸå¸‚</option>
                            <option value="500" selected>500ä¸ªåŸå¸‚</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>æ°”æ³¡å¤§å°æ¯”ä¾‹</label>
                        <input type="range" id="bubbleScale" min="500" max="2000" value="1000">
                        <span id="bubbleScaleValue">1000</span>
                    </div>
                    <div class="control-group">
                        <label>åœ°å›¾æ ·å¼</label>
                        <select id="mapStyle" onchange="updateMap()">
                            <option value="bubble">æ°”æ³¡å›¾</option>
                            <option value="heatmap">çƒ­åŠ›å›¾</option>
                            <option value="scatter">æ•£ç‚¹å›¾</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <button onclick="randomizeMapData()">éšæœºæ•°æ®</button>
                    </div>
                </div>

                <div class="map-container" id="mapContainer">
                    <!-- åœ°å›¾å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                </div>

                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-value" id="cityCount">500</div>
                        <div class="stat-label">åŸå¸‚æ•°é‡</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="maxPopulation">2.5M</div>
                        <div class="stat-label">æœ€å¤§äººå£</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avgPopulation">0.8M</div>
                        <div class="stat-label">å¹³å‡äººå£</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalPopulation">400M</div>
                        <div class="stat-label">æ€»äººå£</div>
                    </div>
                </div>

                <div class="code-snippet">
                    # Basemapåœ°å›¾ç»˜åˆ¶ä»£ç ç¤ºä¾‹<br>
                    map = Basemap(projection='stere', lat_0=90, lon_0=-105)<br>
                    map.scatter(x, y, s=size, cmap='Reds')
                </div>
            </div>

            <div class="card">
                <h3>ğŸŒ åœ°å›¾æŠ•å½±ç±»å‹å¯¹æ¯”</h3>
                <div class="grid-layout">
                    <div class="feature-box">
                        <div class="feature-title">ğŸŒ ç«‹ä½“æŠ•å½± (Stereographic)</div>
                        <div class="feature-desc">é€‚åˆæåœ°åœ°åŒºçš„åœ°å›¾å±•ç¤ºï¼Œä¿æŒè§’åº¦å…³ç³»ï¼Œå¸¸ç”¨äºèˆªç©ºå’Œèˆªæµ·å¯¼èˆªã€‚</div>
                    </div>
                    <div class="feature-box">
                        <div class="feature-title">ğŸ—ºï¸ å¢¨å¡æ‰˜æŠ•å½± (Mercator)</div>
                        <div class="feature-desc">ä¿æŒè§’åº¦å’Œå½¢çŠ¶ï¼Œé€‚åˆä¸–ç•Œåœ°å›¾ï¼Œä½†é«˜çº¬åº¦åœ°åŒºé¢ç§¯ä¼šè¢«å¤¸å¤§ã€‚</div>
                    </div>
                    <div class="feature-box">
                        <div class="feature-title">ğŸŒ ç­‰è·åœ†é”¥æŠ•å½±</div>
                        <div class="feature-desc">é€‚åˆä¸­çº¬åº¦åœ°åŒºï¼Œä¿æŒæ²¿æ ‡å‡†çº¬çº¿çš„è·ç¦»æ¯”ä¾‹ï¼Œå¸¸ç”¨äºå›½å®¶åœ°å›¾ã€‚</div>
                    </div>
                    <div class="feature-box">
                        <div class="feature-title">ğŸ“ æ­£å¼¦æŠ•å½±</div>
                        <div class="feature-desc">ä¿æŒé¢ç§¯æ¯”ä¾‹ï¼Œé€‚åˆå…¨çƒæ•°æ®å¯è§†åŒ–ï¼Œä½†å½¢çŠ¶ä¼šæœ‰å¤±çœŸã€‚</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let animationId = null;
        let surfaceChart = null;
        let animationChart = null;
        let waveChart = null;
        let frameCounter = 0;
        let startTime = null;
        let isAnimating = false;

        // æ ‡ç­¾åˆ‡æ¢
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // åˆå§‹åŒ–å¯¹åº”æ ‡ç­¾é¡µçš„å›¾è¡¨
            if (tabName === 'mplot3d') {
                init3DCharts();
            } else if (tabName === 'animation') {
                initAnimationCharts();
            } else if (tabName === 'basemap') {
                initMap();
            }
        }

        // 3Dæ•£ç‚¹å›¾ç›¸å…³
        function generateStars() {
            const count = document.getElementById('starCount').value;
            const container = document.getElementById('threeDScatter');
            
            // ç§»é™¤æ—§çš„æ˜Ÿæ˜Ÿ
            const oldStars = container.querySelectorAll('.star-3d');
            oldStars.forEach(star => star.remove());
            
            // ç”Ÿæˆæ–°æ˜Ÿæ˜Ÿ
            for (let i = 0; i < count; i++) {
                const star = document.createElement('div');
                star.className = 'star-3d';
                
                const x = Math.random() * 280 - 140;
                const y = Math.random() * 280 - 140;
                const z = Math.random() * 200 - 100;
                
                star.style.transform = `translate3d(${x + 150}px, ${y + 150}px, ${z}px)`;
                
                // æ ¹æ®é«˜åº¦è®¾ç½®é¢œè‰²
                const colorScheme = document.getElementById('colorScheme').value;
                if (colorScheme === 'height') {
                    const hue = (z + 100) / 200 * 60; // 0-60åº¦ï¼Œçº¢åˆ°é»„
                    star.style.background = `radial-gradient(circle, hsl(${hue}, 100%, 60%) 0%, hsl(${hue}, 100%, 40%) 100%)`;
                } else if (colorScheme === 'gold') {
                    star.style.background = 'radial-gradient(circle, #FFD700 0%, #FFA000 100%)';
                }
                
                // è®¾ç½®åŠ¨ç”»å»¶è¿Ÿ
                star.style.animationDelay = `${Math.random() * 2}s`;
                
                container.appendChild(star);
            }
            
            updateStarStats();
        }

        function regenerateStars() {
            generateStars();
        }

        function updateStarStats() {
            const stars = document.querySelectorAll('.star-3d');
            document.getElementById('totalStars').textContent = stars.length;
            
            // è®¡ç®—å¹³å‡é«˜åº¦ï¼ˆç®€åŒ–è®¡ç®—ï¼‰
            let avgHeight = 20 + Math.floor(Math.random() * 10);
            document.getElementById('avgHeight').textContent = avgHeight;
        }

        function rotate3D() {
            const container = document.getElementById('threeDScatter');
            const speed = document.getElementById('rotationSpeed').value;
            let angle = 0;
            
            setInterval(() => {
                angle += speed * 0.5;
                container.style.transform = `rotateX(30deg) rotateY(${angle}deg)`;
                document.getElementById('rotationAngle').textContent = `${Math.floor(angle % 360)}Â°`;
            }, 50);
        }

        // 3Dæ›²é¢å›¾
        function initSurfaceChart() {
            const ctx = document.getElementById('surfaceChart').getContext('2d');
            surfaceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: []
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: '3Då‡½æ•°æ›²é¢å›¾ (2DæŠ•å½±å±•ç¤º)'
                        }
                    },
                    scales: {
                        x: { title: { display: true, text: 'Xè½´' } },
                        y: { title: { display: true, text: 'Zè½´' } }
                    }
                }
            });
            
            updateSurface();
        }

        function updateSurface() {
            const functionType = document.getElementById('functionType').value;
            const resolution = parseInt(document.getElementById('resolution').value);
            const colors = document.getElementById('surfaceColors').value;
            
            // ç”Ÿæˆæ•°æ®
            const x = [];
            const datasets = [];
            
            for (let i = 0; i < resolution; i++) {
                x.push((i - resolution/2) * 0.25);
            }
            
            for (let j = 0; j < resolution; j++) {
                const y = (j - resolution/2) * 0.25;
                const z = [];
                
                for (let i = 0; i < resolution; i++) {
                    const x_val = (i - resolution/2) * 0.25;
                    let z_val = 0;
                    
                    if (functionType === 'sinc') {
                        const r = Math.sqrt(x_val * x_val + y * y);
                        z_val = r === 0 ? 1 : Math.sin(r) / r;
                    } else if (functionType === 'gaussian') {
                        z_val = Math.exp(-(x_val * x_val + y * y) / 10);
                    } else if (functionType === 'ripple') {
                        z_val = Math.sin(Math.sqrt(x_val * x_val + y * y) * 2) / 2;
                    }
                    
                    z.push(z_val);
                }
                
                datasets.push({
                    label: `Y=${y.toFixed(2)}`,
                    data: z,
                    borderColor: `hsl(${(j / resolution) * 360}, 70%, 50%)`,
                    borderWidth: 2,
                    fill: false,
                    pointRadius: 0
                });
            }
            
            surfaceChart.data.labels = x;
            surfaceChart.data.datasets = datasets.slice(0, 20); // é™åˆ¶æ˜¾ç¤ºæ•°é‡
            surfaceChart.update();
        }

        // åŠ¨ç”»ç›¸å…³
        function startAnimation() {
            if (isAnimating) return;
            
            isAnimating = true;
            startTime = Date.now();
            document.getElementById('animStatus').textContent = 'è¿è¡Œä¸­';
            
            animateTwinkle();
        }

        function pauseAnimation() {
            isAnimating = false;
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
            document.getElementById('animStatus').textContent = 'æš‚åœ';
        }

        function resetAnimation() {
            pauseAnimation();
            frameCounter = 0;
            document.getElementById('frameCount').textContent = '0';
            document.getElementById('animDuration').textContent = '0s';
            document.getElementById('animStatus').textContent = 'å°±ç»ª';
            startTime = null;
        }

        function animateTwinkle() {
            if (!isAnimating) return;
            
            frameCounter++;
            document.getElementById('frameCount').textContent = frameCounter;
            
            if (startTime) {
                const duration = ((Date.now() - startTime) / 1000).toFixed(1);
                document.getElementById('animDuration').textContent = `${duration}s`;
            }
            
            animationId = requestAnimationFrame(animateTwinkle);
        }

        // åœ°å›¾ç›¸å…³
        function initMap() {
            updateMap();
        }

        function updateMap() {
            const container = document.getElementById('mapContainer');
            const size = parseInt(document.getElementById('dataSize').value);
            const style = document.getElementById('mapStyle').value;
            
            // æ¸…ç©ºå®¹å™¨
            container.innerHTML = '';
            
            // æ·»åŠ åœ°å›¾èƒŒæ™¯
            const mapBg = document.createElement('div');
            mapBg.style.cssText = `
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(135deg, #FFF8F8 0%, #FFE4E1 100%);
                border-radius: 15px;
            `;
            container.appendChild(mapBg);
            
            // æ·»åŠ åœ°å›¾æ ‡é¢˜
            const title = document.createElement('div');
            title.style.cssText = `
                position: absolute;
                top: 10px;
                left: 50%;
                transform: translateX(-50%);
                font-weight: bold;
                color: #C2185B;
                font-size: 16px;
            `;
            title.textContent = 'ç¾å›½éƒ¨åˆ†åŸé•‡äººå£åˆ†å¸ƒç¤ºæ„å›¾';
            container.appendChild(title);
            
            // ç”Ÿæˆéšæœºåœ°å›¾ç‚¹
            for (let i = 0; i < Math.min(size, 100); i++) {
                const point = document.createElement('div');
                point.className = 'map-point';
                
                const x = Math.random() * 80 + 10; // 10% to 90%
                const y = Math.random() * 70 + 15; // 15% to 85%
                const size = Math.random() * 30 + 5; // 5px to 35px
                const population = Math.random() * 2.5; // 0 to 2.5 million
                
                point.style.cssText = `
                    left: ${x}%;
                    top: ${y}%;
                    width: ${size}px;
                    height: ${size}px;
                    background: radial-gradient(circle, rgba(233, 30, 99, 0.8) 0%, rgba(194, 24, 91, 0.6) 100%);
                    animation-delay: ${Math.random() * 2}s;
                `;
                
                point.title = `äººå£: ${population.toFixed(1)}M`;
                container.appendChild(point);
            }
            
            updateMapStats(size);
        }

        function updateMapStats(size) {
            document.getElementById('cityCount').textContent = size;
            document.getElementById('maxPopulation').textContent = '2.5M';
            document.getElementById('avgPopulation').textContent = '0.8M';
            document.getElementById('totalPopulation').textContent = '400M';
        }

        function randomizeMapData() {
            updateMap();
        }

        // æ³¢å½¢å›¾
        function initWaveChart() {
            const ctx = document.getElementById('waveChart').getContext('2d');
            
            waveChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array.from({length: 100}, (_, i) => i),
                    datasets: [
                        {
                            label: 'æ­£å¼¦æ³¢',
                            data: Array.from({length: 100}, (_, i) => Math.sin(i * 0.1)),
                            borderColor: '#E91E63',
                            borderWidth: 3,
                            fill: false,
                            tension: 0.4
                        },
                        {
                            label: 'ä½™å¼¦æ³¢',
                            data: Array.from({length: 100}, (_, i) => Math.cos(i * 0.1)),
                            borderColor: '#FF5722',
                            borderWidth: 3,
                            fill: false,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'æ­£å¼¦æ³¢ä¸ä½™å¼¦æ³¢åŠ¨ç”»'
                        }
                    },
                    scales: {
                        x: { title: { display: true, text: 'æ—¶é—´' } },
                        y: { title: { display: true, text: 'æŒ¯å¹…' } }
                    },
                    animation: {
                        duration: 2000,
                        loop: true
                    }
                }
            });
            
            updateWave();
        }

        function updateWave() {
            const count = document.getElementById('waveCount').value;
            const speed = document.getElementById('waveSpeed').value;
            const phase = document.getElementById('phaseShift').value * Math.PI / 180;
            
            const datasets = [];
            const colors = ['#E91E63', '#FF5722', '#4CAF50', '#2196F3', '#9C27B0'];
            
            for (let i = 0; i < count; i++) {
                datasets.push({
                    label: `æ³¢å½¢ ${i + 1}`,
                    data: Array.from({length: 100}, (_, j) => {
                        return Math.sin(j * 0.1 + i * phase);
                    }),
                    borderColor: colors[i % colors.length],
                    borderWidth: 3,
                    fill: false,
                    tension: 0.4
                });
            }
            
            waveChart.data.datasets = datasets;
            waveChart.options.animation.duration = 3000 / speed;
            waveChart.update();
        }

        // åŠ¨ç”»å›¾è¡¨
        function initAnimationChart() {
            const ctx = document.getElementById('animationChart').getContext('2d');
            
            animationChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'é—ªçƒæ˜Ÿæ˜Ÿ',
                        data: Array.from({length: 10}, (_, i) => ({
                            x: Math.random() * 100,
                            y: Math.random() * 100
                        })),
                        backgroundColor: '#FFD700',
                        pointRadius: 10,
                        pointStyle: 'star'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: '3Dç©ºé—´é—ªçƒæ˜Ÿæ˜ŸåŠ¨ç”»'
                        }
                    },
                    scales: {
                        x: { min: 0, max: 100 },
                        y: { min: 0, max: 100 }
                    },
                    animation: {
                        duration: 1000,
                        loop: true
                    }
                }
            });
        }

        // åˆå§‹åŒ–å‡½æ•°
        function init3DCharts() {
            if (!surfaceChart) {
                initSurfaceChart();
            }
            generateStars();
            rotate3D();
        }

        function initAnimationCharts() {
            if (!animationChart) {
                initAnimationChart();
            }
            if (!waveChart) {
                initWaveChart();
            }
        }

        // äº‹ä»¶ç›‘å¬å™¨
        document.getElementById('starCount').addEventListener('input', function(e) {
            document.getElementById('starCountValue').textContent = e.target.value;
            generateStars();
        });

        document.getElementById('twinkleSpeed').addEventListener('input', function(e) {
            document.getElementById('twinkleSpeedValue').textContent = e.target.value + 'ms';
        });

        document.getElementById('animStarCount').addEventListener('input', function(e) {
            document.getElementById('animStarCountValue').textContent = e.target.value;
        });

        document.getElementById('waveCount').addEventListener('input', function(e) {
            document.getElementById('waveCountValue').textContent = e.target.value;
            updateWave();
        });

        document.getElementById('waveSpeed').addEventListener('input', function(e) {
            document.getElementById('waveSpeedValue').textContent = e.target.value;
            updateWave();
        });

        document.getElementById('phaseShift').addEventListener('input', function(e) {
            document.getElementById('phaseShiftValue').textContent = e.target.value + 'Â°';
            updateWave();
        });

        document.getElementById('bubbleScale').addEventListener('input', function(e) {
            document.getElementById('bubbleScaleValue').textContent = e.target.value;
            updateMap();
        });

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            init3DCharts();
        });
    </script>
</body>
</html>